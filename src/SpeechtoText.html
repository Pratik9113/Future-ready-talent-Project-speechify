<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speech Recognition</title>
</head>
<body style="font-family:'Helvetica Neue',Helvetica,Arial,sans-serif; font-size:13px;">

<div id="warning">
    <h1 style="font-weight:500;">Speech Recognition Speech SDK not found (microsoft.cognitiveservices.speech.sdk.bundle.js missing).</h1>
</div>

<div id="content" style="display:none">
    <table width="100%">
        <tr>
            <td></td>
            <td><h1 style="font-weight:500;">Microsoft Cognitive Services Speech SDK JavaScript Quickstart</h1></td>
        </tr>
        <tr>
            <td align="right"><a href="https://docs.microsoft.com/azure/cognitive-services/speech-service/get-started" target="_blank" rel="noopener">Subscription</a>:</td>
            <td><input id="subscriptionKey" type="text" size="40" value=""></td>
        </tr>
        <tr>
            <td align="right">Region</td>
            <td><input id="serviceRegion" type="text" size="40" value=""></td>
        </tr>
        <tr>
            <td align="right">Source Language</td>
            <td>
                <select id="languageSourceOptions">
                    <option selected="selected" value="en-US">English</option>
                </select>
            </td>
        </tr>
        <tr>
            <td align="right">Target Language</td>
            <td>
                <select id="languageTargetOptions">
                    <option selected="selected" value="en-US">English</option>
                </select>
            </td>
        </tr>
        <tr>
            <td></td>
            <td><button id="startRecognizeOnceAsyncButton">Start recording</button></td>
        </tr>
        <tr>
            <td align="right" valign="top">Results</td>
            <td><textarea id="phraseDiv" style="display: inline-block;width:500px;height:200px"></textarea></td>
        </tr>
    </table>
</div>

<!-- Speech SDK reference -->
<script src="https://aka.ms/csspeech/jsbrowserpackageraw"></script>
<script>
    // status fields and start button in UI
    var phraseDiv;
    var startRecognizeOnceAsyncButton;

    // subscription key and region for speech services.
    var subscriptionKey, serviceRegion, languageSourceOptions, languageTargetOptions;
    var SpeechSDK;
    var recognizer;

    document.addEventListener("DOMContentLoaded", function () {
        startRecognizeOnceAsyncButton = document.getElementById("startRecognizeOnceAsyncButton");
        subscriptionKey = document.getElementById("subscriptionKey");
        serviceRegion = document.getElementById("serviceRegion");
        languageTargetOptions = document.getElementById("languageTargetOptions");
        languageSourceOptions = document.getElementById("languageSourceOptions");
        phraseDiv = document.getElementById("phraseDiv");

        startRecognizeOnceAsyncButton.addEventListener("click", function () {
            startRecognizeOnceAsyncButton.disabled = true;
            phraseDiv.innerHTML = "";

            if (subscriptionKey.value === "") {
                alert("Please enter your Microsoft Cognitive Services Speech subscription key!");
                startRecognizeOnceAsyncButton.disabled = false;
                return;
            }

            if (serviceRegion.value === "") {
                alert("Please enter the region for your Cognitive Services subscription!");
                startRecognizeOnceAsyncButton.disabled = false;
                return;
            }

            var speechConfig = SpeechSDK.SpeechConfig.fromSubscription(subscriptionKey.value, serviceRegion.value);
            speechConfig.speechRecognitionLanguage = languageSourceOptions.value;

            var audioConfig = SpeechSDK.AudioConfig.fromDefaultMicrophoneInput();
            recognizer = new SpeechSDK.SpeechRecognizer(speechConfig, audioConfig);

            recognizer.recognizeOnceAsync(
                function (result) {
                    startRecognizeOnceAsyncButton.disabled = false;
                    phraseDiv.innerHTML += result.text;
                    recognizer.close();
                    recognizer = undefined;
                },
                function (err) {
                    startRecognizeOnceAsyncButton.disabled = false;
                    phraseDiv.innerHTML += err;
                    recognizer.close();
                    recognizer = undefined;
                }
            );
        });

        if (!!window.SpeechSDK) {
            SpeechSDK = window.SpeechSDK;
            startRecognizeOnceAsyncButton.disabled = false;
            document.getElementById('content').style.display = 'block';
            document.getElementById('warning').style.display = 'none';
        } else {
            console.error("Speech SDK not loaded!");
        }
    });
</script>
</body>
</html>
